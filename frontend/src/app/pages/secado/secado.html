<div class="page">

  <h2>Secado</h2>

  <div *ngIf="cargando" class="loading">
    Cargando lotes...
  </div>

  <div *ngIf="!cargando && lotes.length === 0" class="empty">
    No hay lotes en secado
  </div>

  <table *ngIf="!cargando && lotes.length > 0" class="tabla">
    <thead>
      <tr>
        <th>Código</th>
        <th>Fecha Compra</th>
        <th>Proveedor</th>
        <th>Estado</th>
        <th>Acción</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let lote of lotes">
        <td>{{ lote.codigo }}</td>
        <td>{{ lote.fecha_compra | date:'dd/MM/yyyy' }}</td>
        <td>{{ lote.proveedor_nombre }}</td>
        <td>{{ lote.estado }}</td>
        <td>
          <button class="btn-danger"
                  (click)="abrirModalFinalizar(lote)">
            Finalizar Secado
          </button>
        </td>
      </tr>
    </tbody>
  </table>

</div>

<!-- MODAL FINALIZAR -->

<div class="overlay" *ngIf="mostrarModal && loteSeleccionado">

  <div class="modal-box">

    <h3>Finalizar Secado - {{ loteSeleccionado.codigo }}</h3>

    <div class="form-grid">

      <div>
        <label>Fecha</label>
        <input type="date"
               [(ngModel)]="formFinal.fecha_fin">
      </div>

      <div>
        <label>Hora</label>
        <input type="time"
               [(ngModel)]="formFinal.hora_fin">
      </div>

      <div>
        <label>Tipo</label>
        <input type="text"
               value="FIN"
               disabled>
      </div>

      <div>
        <label>Temp. Ambiente</label>
        <input type="number"
               [(ngModel)]="formFinal.temperatura_ambiente">
      </div>

    </div>

    <div class="modal-actions">
      <button class="btn-secondary"
              (click)="cerrarModal()">
        Cancelar
      </button>

      <button class="btn-danger"
              (click)="finalizarSecado()">
        Confirmar
      </button>
    </div>

  </div>

</div>

<!-- MENSAJE -->

<div *ngIf="mostrarMensaje"
     class="toast"
     [ngClass]="{
       'toast-success': tipoMensaje === 'success',
       'toast-error': tipoMensaje === 'error'
     }">
  {{ mensaje }}
</div>
